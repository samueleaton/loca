module.exports=function(){function t(t,e){a[t]&&a[t].forEach(function(t){t("undefined"!=typeof e?e:void 0)})}function e(e){var r;try{r=JSON.parse(e)}catch(n){t("error","JSON file not valid | "+n),r=null}return r}function r(t,e,r){if("undefined"==typeof e||null===e)return t;for(var n=e.trim().split("."),i=t,o=0,a=n.length;a>o;o++){if(!i[n[o]])return"function"==typeof r?r(!0,null):void 0;i=i[n[o]]}return r(!1,i)}function n(t){var e=_[t.__name__];if(e[isProperty]){var r=_[e[propertyOf]];return r[isProperty]?n(r)+"."+e[path]:e[path]}return""}function i(e,r,n){if(t(e+" "+r,n),_[e].isProperty){var o=_[e].propertyOf;console.log("ParentName",o),console.log("_localData",_),i(o,r,_[o].data)}}var o=require("fs"),a={},_={},f={commit:function(e){if(_[this.__name__].data){var r=this;o.writeFile(_[this.__name__][path],JSON.stringify(this.get()),function(n){n&&t("error","error committing local data to file"),"function"==typeof e&&(i(r.__name__,"committed",r.get()),e())})}},get:function(e){if("undefined"==typeof e||null===e)return _[this.__name__].data;if("string"!=typeof e)return t("error",this.__name__+".get only takes a paramter of type 'string', 'undefined', or 'null'. You passed a parameter of type '"+typeof e+"'.");for(var r=e.trim().split("."),n=_[this.__name__].data,i=0,o=r.length;o>i;i++){if(!n[r[i]])return t("error","query path not found "+e);n=n[r[i]]}return n},set:function(e,r){if("undefined"!=typeof e){if(null===e)return _[this.__name__].data=r;for(var n=e.trim().split("."),o=_[this.__name__].data,a=0,f=n.length;f>a;a++){if(!o[n[a]])return t("error",this.__name__+".set error  |  Query path not found: "+e+"  |  Error Occured at: "+n[a]);if(a===n.length-1)return o[n[a]]=r,void i(this.__name__,"set",this.get());o=o[n[a]]}}},reset:function(a,f){function s(t){return _[t.__name__][isProperty]?s(_[_[t.__name__][propertyOf]]):_[t.__name__][path]}var u=this;o.readFile(s(this),"utf-8",function(o,s){if(o)return t("error",o);var p=e(s);if(p){if("undefined"==typeof a||null===a)return _[u.__name__][isProperty]?u.set(null,r(p,n(u))):_[u.__name__].data=p,i(u.__name__,"reset",u.get()),"function"==typeof f?f():void 0;if("string"==typeof a){var c=_[u.__name__][isProperty]?n(u)+"."+a:a;r(p,c,function(e,r){return e?t("error","error message"):(u.set(a,r),i(u.__name__,"reset",u.get()),"function"==typeof f?f():void 0)})}else if("string"!=typeof a)return t("error",u.__name__+".reset's first paramter only takes a paramter of type 'string', 'undefined', or 'null'. You passed a parameter of type '"+typeof a+"'.")}})},createProperty:function(e,r,n){if("string"!=typeof e)return t("error","Property name (1st param) passed to "+this.__name__+".createProperty is not of type 'string'.");if("string"!=typeof r)return t("error","Query Path (2nd param) passed to "+this.__name__+".createProperty is not of type 'string'.");for(var i=r.trim().split("."),o=_[this.__name__].data,a=0,s=i.length;s>a;a++){if(!o[i[a]])return t("error","query path not found "+r);o=o[i[a]]}this[e]=Object.create(f),this[e].__name__=e,_[e]={data:o,path:r,isProperty:!0,propertyOf:this.__name__},this[e].config(n)},config:function(t){_[this.__name__].onSet=t&&"string"==typeof t.onSet?t.onSet:_[this.__name__].onSet,_[this.__name__].onReset=t&&"string"==typeof t.onReset?t.onReset:_[this.__name__].onReset}},s={on:function(t,e){a[t]=a[t]||[],a[t].push(e)},off:function(t,e){if(a[t])for(var r=0;r<a[t].length;r++)if(a[t][r]===e){a[t].splice(r,1);break}},init:function(r,n,i,a){if("undefined"==typeof this[r]){var s=this;o.readFile(n,"utf-8",function(o,u){if(o)return t("error",o);var p=e(u);if(p)return s[r]=Object.create(f),s[r].__name__=r,_[r]={data:p,path:n,isProperty:!1,propertyOf:null},s[r].config(i),t("init "+r),"function"==typeof a?a():void 0})}else if(err)return t("error",err)}};return Object.create(s)}();